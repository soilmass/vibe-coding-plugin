name: PR Size Check

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  check-size:
    runs-on: ubuntu-latest
    steps:
      - name: Check PR size
        uses: actions/github-script@v7
        with:
          script: |
            const { data: files } = await github.rest.pulls.listFiles({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: context.issue.number,
              per_page: 100,
            });

            const totalChanges = files.reduce((sum, file) => sum + file.changes, 0);
            const fileCount = files.length;

            const warnings = [];
            if (totalChanges > 400) {
              warnings.push(`- **${totalChanges} lines changed** (recommended: <400)`);
            }
            if (fileCount > 10) {
              warnings.push(`- **${fileCount} files changed** (recommended: <10)`);
            }

            if (warnings.length > 0) {
              const body = [
                '## ⚠️ Large PR Detected',
                '',
                'This PR may be difficult to review due to its size:',
                '',
                ...warnings,
                '',
                '**Consider splitting into smaller PRs** for easier review and safer merging.',
                '',
                '<details>',
                '<summary>Files changed</summary>',
                '',
                files.map(f => `- \`${f.filename}\` (+${f.additions} -${f.deletions})`).join('\n'),
                '',
                '</details>',
              ].join('\n');

              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                body,
              });
            }
